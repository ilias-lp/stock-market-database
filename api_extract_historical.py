import yfinance as yf
import pandas as pd
import time
import os

# Configuration
OUTPUT_DIR = "stock_data"  # Folder to save CSVs
os.makedirs(OUTPUT_DIR, exist_ok=True)  # Create folder if missing

# List of stocks
tickers = ["NOVO-B.CO", "SAP.DE", "MC.PA", "RMS.PA", "ASML.AS", "RO.SW", "NESN.SW", "AZN.L", "SHEL.L", "NOVN.SW", "HSBA.L", "OR.PA", "SIE.DE", "DTE.DE", "ITX.MC", "ALV.DE", "AIR.PA", "ULVR.L", "SU.PA", "SAN.PA", "EL.PA", "TTE.PA", "ABI.BR", "SAF.PA", "AI.PA", "CDI.PA", "SAN.MC", "CFR.SW", "UBSG.SW", "RIO.L", "RACE.MI", "ABBN.SW", "PRX.AS", "BNP.PA", "ZURN.SW", "IBE.MC", "INVE-A.ST", "ISP.MI", "CS.PA", "REL.L", "BP.L", "UCG.MI", "BATS.L", "RR.L", "MUV2.DE", "BBVA.MC", "ENEL.MI", "ATCO-A.ST", "GSK.L", "LSEG.L", "DG.PA", "EQNR.OL", "HOLN.SW", "INGA.AS", "VOLV-A.ST", "RHM.DE", "SHL.DE", "MBG.DE", "MRK.DE", "NG.L", "BA.L", "DGE.L", "CABK.MC", "LLOY.L", "BARC.L", "VOW.DE", "ACA.PA", "DSY.PA", "HO.PA", "G.MI", "BMW.DE", "CPG.L", "SGO.PA", "DB1.DE", "DHL.DE", "ADYEN.AS", "ENR.DE", "UMG.AS", "P911.DE", "SREN.SW", "BN.PA", "DBK.DE", "IFX.DE", "BAS.DE", "NWG.L", "GLEN.L", "DSV.CO", "III.L", "ENI.MI", "ENGI.PA", "ALC.SW", "STLAM.MI", "STLAM.MI", "NDA-SE.ST", "HEIA.AS", "RKT.L", "LONN.SW", "HLN.L", "ADS.DE", "EXPN.L", "AAL.L", "SIKA.SW", "EQT.ST", "PGHN.SW", "KBC.BR", "GIVN.SW", "DNB.OL", "EOAN.DE", "STAN.L", "ARGX.BR", "SEB-A.ST", "HNR1.DE", "UCB.BR", "AENA.MC", "WKL.AS", "AMS.MC", "HEI.DE", "SCHN.SW", "ORA.PA", "ASSA-B.ST", "GLE.PA", "AD.AS", "EXO.AS", "DTG.DE", "FER.MC", "HEN.DE", "SCMN.SW", "HEXA-B.ST", "CBK.DE", "LISN.SW", "KNEBV.HE", "LR.PA", "SWED-A.ST", "IMB.L", "EBS.VI", "DANSKE.CO", "SAND.ST", "NOKIA.HE", "TSCO.L", "BEI.DE", "LDO.MI", "PRU.L", "ERIC-A.ST", "HLAG.DE", "CCL.L", "KNIN.SW", "MAERSK-A.CO", "CAP.PA", "TLX.DE", "NSIS-B.CO", "ELE.MC", "KER.PA", "NTGY.MC", "AM.PA", "SHB-A.ST", "RWE.DE", "MT.AS", "SLHN.SW", "TEF.MC", "ML.PA", "KOG.OL", "DSFIR.AS", "CEZ.PR", "GALD.SW", "PKO.WA", "SAMPO.HE", "PUB.PA", "RI.PA", "VIE.PA", "BAYN.DE", "AHT.L", "EPI-A.ST", "VER.VI", "CLNX.MC", "ANTO.L", "FRE.DE", "ASM.AS", "PHIA.AS", "TEN.MI", "COLO-B.CO", "RYA.IR", "VOD.L", "PST.MI", "SSE.L", "STMPA.PA", "HM-B.ST", "CVC.AS", "VNA.DE", "GEBN.SW", "SAAB-B.ST", "PKN.WA", "BT-A.L", "EBK.DE", "STMN.SW", "HEIO.AS", "DIM.PA", "ESSITY-A.ST", "MTX.DE", "UN0.DE", "TEL.OL", "AV.L", "SDZ.SW", "ORSTED.CO", "OTP.BD", "ALFA.ST", "SGSN.SW", "IAG.L", "LGEN.L", "ABN.AS", "8TRA.DE", "PRY.MI", "ABF.L", "WISE.L", "TRN.MI", "SOON.SW", "MONC.MI", "IHG.L", "CARL-A.CO", "BOL.PA", "LIFCO-B.ST", "EVO.ST", "LATO-B.ST", "SRG.MI", "BAMI.MI", "AMUN.PA", "A5G.IR", "KRZ.IR", "OMV.VI", "INDU-A.ST", "EMSN.SW", "SAB.MC", "CCH.L", "MB.MI", "KPN.AS", "SPL.WA", "RNO.PA", "ACS.MC", "SRT.DE", "SMT.L", "CON.DE", "KBX.DE", "VWS.CO", "SGE.L", "KRX.IR", "UPM.HE", "REP.MC", "BIM.PA", "NXT.L", "EN.PA", "FORTUM.HE", "ENX.PA", "AKRBP.OL", "NEM.DE", "BAER.SW", "NN.AS", "FME.DE", "BVI.PA", "EDP.LS", "TRYG.CO", "LOGN.SW", "HOT.DE", "INF.L", "SY1.DE", "TELIA.ST", "JMT.LS", "HLMA.L", "PZU.WA", "AKEL-D.ST", "LUND-B.ST", "BNZL.L", "GALP.LS", "PNDORA.CO", "NHY.OL", "BIRG.IR", "PAH3.DE", "PEO.WA", "FBK.MI", "SN.L", "SGRO.L", "BMED.MI", "GMAB.CO", "ASRNL.AS", "REC.MI", "UNI.MI", "BPE.MI", "WRT1V.HE", "H2O.RO", "URW.PA", "AC.PA", "DWS.DE", "FGR.PA", "1CO.F", "VACN.SW", "DNP.WA", "ADM.L", "RTO.L", "GJF.OL", "AGS.BR", "ING.WA", "AKZA.AS", "HELN.SW", "ALO.PA", "G1A.DE", "ORK.OL", "INDT.ST", "EVK.DE", "HLE.DE", "BMPS.MI", "ADP.PA", "ERF.PA", "EUROB.AT", "JDEP.AS", "RED.MC", "EVD.DE", "PSON.L", "ITRK.L", "BKT.MC", "BZU.MI", "MOWI.OL", "BOL.ST", "RAA.DE", "SKA-B.ST", "ETE.AT", "GBLB.BR", "SNP.RO", "SKF-A.ST", "PUIG.MC", "SOBI.ST", "SW.PA", "BNR.DE", "METSO.HE", "IPN.PA", "DIE.BR", "ROCK-A.CO", "BALN.SW", "LHA.DE", "SPSN.SW", "EDNR.MI", "MBK.WA", "MAP.MC", "SVT.L", "BESI.AS", "INW.MI", "GET.PA", "CNA.L", "SCA-A.ST", "BCVN.SW", "CA.PA", "BCP.LS", "LI.PA", "UHR.SW", "TREL-B.ST", "RBI.VI", "TEL2-A.ST", "PSH.AS", "KOMB.PR", "BKW.SW", "ZAL.DE", "EDPR.LS", "SMIN.L", "ALE.WA", "SOF.BR", "MKS.L", "MRO.L", "STR.VI", "LPP.WA", "AUTO.L", "WPP.L", "UU.L", "BG.VI", "ORNAV.HE", "DWNI.DE", "RXL.PA", "HAG.DE", "CTPNV.AS", "SECU-B.ST", "NIBE-B.ST", "WEIR.L", "ADDT-B.ST", "EDEN.PA", "IMCD.AS", "O5G.DE", "BEAN.SW", "RAND.AS", "KESKOA.HE", "BC.MI", "BTRW.L", "DEMANT.CO", "ELISA.HE", "YAR.OL", "J4V0.F", "AAF.L", "G24.DE", "CBDG.PA", "STE-R.ST", "INPST.AS", "SDR.L", "AYV.PA", "BEIJ-B.ST", "ICG.L", "VZN.SW", "DHER.DE", "SIGN.SW", "SYENS.BR", "A2A.MI", "FHZN.SW", "PHNX.L", "LOTB.BR", "CPR.MI", "NESTE.HE", "KBHL.CO", "BALD-B.ST", "ACKB.BR", "OPAP.AT", "SAGA-A.ST", "KGH.WA", "BARN.SW", "AAK.ST", "SPIE.PA", "ANA.MC", "BEZ.L", "TPEIR.AT", "STJ.L", "TIT.MI", "PSPN.SW", "SBRY.L", "RMV.L", "FCIT.L", "MNDI.L", "CTEC.L", "GFC.PA", "DPLM.L", "ZEG.L", "MNG.L", "HTO.AT", "SSAB-A.ST", "SALM.OL", "NEXI.MI", "SQN.SW", "SWEC-A.ST", "DCC.L", "AFX.DE", "ODET.PA", "BGN.MI", "SCHA.OL", "AVOL.SW", "REY.MI", "TUB.BR", "ELI.BR", "IMI.L", "TKA.DE", "NEOEN.PA", "VOLCAR-B.ST", "GF.SW", "SPX.L", "SUN.SW", "HOLM-A.ST", "ANDR.VI", "TKA.VI", "ALW.L", "HER.MI", "PIRC.MI", "IVG.MI", "AKE.PA", "ANE.MC", "COV.PA", "KCR.HE", "SAVE.ST", "GAW.L", "MLHK.PA", "GRF.MC", "KGX.DE", "TEP.PA", "GETI-B.ST", "RRTL.DE", "ALPHA.AT", "SB1NO.OL", "FPE.DE", "MRL.MC", "TE.PA", "CDR.WA", "FDJU.PA", "GTT.PA", "MYTIL.AT", "WTB.L", "ZEAL.CO", "FRA.DE", "HIK.L", "BPSO.MI", "KRK.WA", "STB.OL", "PPC.AT", "IG.MI", "VIG.VI", "TLV.RO", "DIA.MI", "TEMN.SW", "KGF.L", "INVP.L", "ZAB.WA", "JYSK.CO", "RF.PA", "ELIS.PA", "YPSN.SW", "ALB.MC", "VALMT.HE", "SCR.PA", "ENT.L", "DKSH.SW", "OBS.VI", "WDP.BR", "GCO.MC", "RIG2.F", "SK.PA", "HWDN.L", "CRDA.L", "TW.L", "FCC.MC", "LEG.DE", "SFSN.SW", "IDR.MC", "AG1.DE", "BC8.DE", "DLG.MI", "CAST.ST", "UTG.L", "ADEN.SW", "AZA.ST", "COLR.BR", "MOL.BD", "SNG.RO", "PSN.L", "JD.L", "SECT-B.ST", "UNI.MC", "VPK.AS", "LTMC.MI", "KBCA.BR", "EFGN.SW", "EMMN.SW", "FLU.VI", "PCT.L", "CE.MI", "PGE.WA", "RILBA.CO", "AMBU-B.CO", "EZJ.L", "AMP.MI", "LMP.L", "BAB.L", "DLG.L", "SUBC.OL", "R3NK.BE", "VOE.VI", "AXFO.ST", "FDR.MC", "NEX.PA", "AZE.BR", "ACLN.SW", "ARCAD.AS", "BLND.L", "BKG.L", "SPM.MI", "LAGR-B.ST", "RNT.F", "HLUN-A.CO", "KRN.DE", "BANB.SW", "VK.PA", "MIL.WA", "SFZN.SW", "FNTN.DE", "BBOX.L", "IDS.L", "ALK-B.CO", "TOM.OL", "GALE.SW", "NDA.DE", "BUCN.SW", "MGYA.F", "WCH.DE", "TKWY.AS", "MYCR.ST", "TPRO.MI", "MF.PA", "ISS.CO", "HBR.L", "AKER.OL", "IGG.L", "SHA0.F", "ACE.MI", "SCT.L", "SPG.F", "BNP.WA", "BDX.WA", "EVN.VI", "VONN.SW", "AZM.MI", "LOG.MC", "FNOX.ST", "IP.MI", "TUI1.DE", "CCC.WA", "BNJ.AS", "BHW.WA", "SOP.PA", "FIE.DE", "ALR.WA", "GIL.DE", "AALB.AS", "WIE.VI", "LUKN.SW", "ABDN.L", "HUH1V.HE", "NDX1.DE", "BELA.AT", "ITV.L", "NKT.CO", "SOLB.BR", "PUM.DE", "DEC.PA", "IOS.DE", "1SXP.DE", "VRLA.PA", "WAWI.OL", "RBREW.CO", "CLN.SW", "UTDI.F", "SIX2.DE", "BRBY.L", "WBD.MI", "TKO.PA", "BWY.L", "JUN3.DU", "SBMO.AS", "3IN.L", "ALMB.CO", "DEME.BR", "ALLFG.AS", "ALSN.SW", "JGGI.L", "CAMX.ST", "SOL.MI", "ENG.MC", "COL.MC", "INCH.L", "ATE.PA", "BPT.L", "FLY.PA", "BREB.BR", "COVH.PA", "RCP.L", "RS1.L", "FCT.MI", "VU.PA", "SHUR.BR", "CCC.L", "ROR.L", "SPNO.CO", "SAX.DE", "FRAS.L", "KEMIRA.HE", "VID.MC", "PHLL.L", "CGCBV.HE", "N91.L", "ACP.WA", "PLX.PA", "BME.L", "THULE.ST", "CWK.L", "PNDX-B.ST", "ITP.PA", "ALLN.SW", "TITC.BR", "HEM.ST", "SYDB.CO", "CMBN.SW", "HPOL-B.ST", "ARTO.PA", "UQA.VI", "SGKN.SW", "MONET.PR", "BGEO.L", "DOKA.SW", "UKW.L", "TBCG.L", "AED.BR", "MAIRE.MI", "IRE.MI", "MANTA.HE", "EMG.L", "VIS.MC", "SHC.L", "SXS.L", "N1V2.F", "DESN.SW", "MMB.PA", "OPL.WA", "MCOV-B.ST", "VIV.PA", "ITH.L", "MNKS.L", "MOVE.SW", "BRE.MI", "CIE.MC", "JMAT.L", "FLS.CO", "AIA.AT", "TATE.L", "BBY.L", "NHH.MC", "ACX.MC", "HGT.L", "RUI.PA", "PTEC.L", "NK.PA", "Q1D.F", "FMONC.PA", "CTY.L", "LSG.OL", "318.F", "ERG.MI", "HUSQ-A.ST", "WIHL.ST", "LIGHT.AS", "COFA.PA", "GL9.IR", "ZUGER.SW", "HICL.L", "SCYR.MC", "ROVI.MC", "LXS.DE", "LOOMIS.ST", "WALL-B.ST", "RDC.F", "VIRP.PA", "GBF.DE", "BRD.RO", "EBRO.MC", "GXI.DE", "AT1.DE", "1U1.DE", "LLBN.SW", "AF.PA", "VTY.L", "QLT.L", "BAIN.PA", "DRX.L", "LOUP.PA", "PNN.L", "IFCN.SW", "QQ.L", "BB.PA", "FR.PA", "BOSS.DE", "MOH.AT", "OCDO.L", "FTK.DE", "IDL.PA", "BILL.ST", "PROT.OL", "DLN.L", "INPP.L", "CPS.WA", "TCAP.L", "SNN.RO", "CLDN.L", "SZU.DE", "BEKN.SW", "ELPE.AT", "TRI.PA", "TENERGY.AT", "MOBN.SW", "TECN.SW", "RSW.L", "GN.CO", "TRUE-B.ST", "VCT.PA", "CATE.ST", "NVG.LS", "OLT.OL", "MELE.BR", "COFB.BR", "RCO.PA", "BURE.ST", "OCI.AS", "HVPE.L", "FABG.ST", "CAN.L", "MING.OL", "UMI.BR", "SRAIL.SW", "CPI.VI", "CAI.VI", "NOD.OL", "TGYM.MI", "APAM.AS", "SDF.DE", "SGBAF", "ALTA.PA", "ELUX-A.ST", "NOS.LS", "IWG.L", "KALMAR.HE", "BCHN.SW", "JAM.L", "DNLM.L", "EMBRAC-B.ST", "CEM.MI", "ANIM.MI", "SSON.L", "ALM.MC", "HMS.ST", "GRG.L", "PCO.WA", "DAE.SW", "VGP.BR", "STOR-B.ST", "PEAB-B.ST", "BYG.L", "ROO.L", "TEM.L", "TIETO.HE", "PROX.BR", "BFT.WA", "DMP.DE", "TRIG.L", "MFEA.MI", "POST.VI", "VIT-B.ST", "TEG.DE", "WIZZ.L", "VLK.AS", "VITR.ST", "UNBL.PA", "SON.LS", "KOJAMO.HE", "GFTU.L", "AJB.L", "TXGN.SW", "SPOL.OL", "MVV1.DE", "AOF.DE", "MRC.L", "TPE.WA", "SOLV.BR", "RAT.L", "OSB.L", "BETS-B.ST", "ASMDEE-B.ST", "KTY.WA", "MTRS.ST", "AFRY.ST", "ARYN.SW", "DOFG.OL", "ALLEI.ST", "HUFV-A.ST", "KARN.SW", "SOI.PA", "QTCOM.HE", "ANTIN.PA", "CENER.BR", "VATN.SW", "CRL.MI", "SCHO.CO", "TMV.F", "ENA.WA", "XTB.WA", "EKTA-B.ST", "ENAV.MI", "FEV.L", "BONEX.ST", "INRN.SW", "BREE.L", "BCGE.SW", "B4B.DE", "WKBN.SW", "DAN.MI", "JTC.L", "COTN.SW", "ES.PA", "VIMIAN.ST", "SRP.L", "IPS.PA", "DOC.VI", "PNL.L", "ENOG.L", "KWS.F", "PEUG.PA", "MYI.L", "WLN.PA", "PFD.L", "BCG.L", "KINV-A.ST", "RHIM.VI", "KRU.WA", "JUST.L", "BEKB.BR", "MGNS.L", "CAR.WA", "ENTRA.OL", "HILS.L", "PDX.ST", "GEKTERNA.AT", "CMBT.BR", "WWH.L", "ATRLJ-B.ST", "PAG.L", "AGR.L", "AUSS.OL", "GRI.L", "OEM-B.ST", "NETC.CO", "SINCH.ST", "RENE.LS", "TGS.OL", "ATT.L", "PLNW.PA", "EPRO-B.ST", "MMT.PA", "BRAV.ST", "VEI.OL", "SKAN.SW", "ISB.IC", "EXENS.PA", "HEAD.L", "VAIAS.HE", "VAHN.SW", "IVSO.ST", "DUE.DE", "FRVIA.PA", "UBI.PA", "CADLR.OL", "CFT.SW", "OUT1V.HE", "MTO.L", "ALIF-B.ST", "BAVA.CO", "EMEIS.PA", "NBS.L", "NB2.MU", "MMK.VI", "EMBLA.CO", "PIN.L", "ARG.PA", "LAND.SW", "TEP.L", "BELL.SW", "SMWH.L", "CEC.DE", "BOSN.SW", "BHMG.L", "FCSS.L", "RBT.PA", "TRMD-A.CO", "FUR.AS", "ETL.PA", "KTN.DE", "HOC.L", "ARION.IC", "TWEKA.AS", "SVS.L", "THEON.AS", "SHOT.ST", "NCC-A.ST", "PHM.MC", "NYF.ST", "MOL.MI", "COA.L", "SAFE.L", "GLPG.AS", "IREN.SW", "GEST.MC", "MAB.L", "VIO.BR", "HAS.L", "GYC.DE", "WWI.OL", "ICAD.PA", "ARIS.MI", "FGT.L", "RWAY.MI", "TTALO.HE", "ERA.PA", "BFF.MI", "PFV.F", "GNS.L", "SZG.DE", "BAMNB.AS", "PHP.L", "BLV.PA", "BNOR.OL", "STF.PA", "BRG.OL", "DEQ.DE", "SRE.L", "PRODEA.AT", "HUBN.SW", "CLARI.PA", "BUFAB.ST", "BIOA-B.ST", "MEL.MC", "YUBICO.ST", "SSPG.L", "SYSR.ST", "NOLA-B.ST", "BNKR.L", "MONT.BR", "ENO.MC", "AQ.ST", "HMSO.L", "OPM.PA", "MVC.MC", "PSM.DE", "WAC.DE", "TPK.L", "JDAN.CO", "KSB.DE", "SANOMA.HE", "AKSO.OL", "TRN.L", "GPE.L", "DOM.ST", "LIAB.ST", "TESB.BR", "BYIT.L", "LWDB.L", "UIE.CO", "HAVAS.AS", "ALHG.PA", "OERL.SW", "SVEG.OL", "HBH.F", "FAGR.BR", "SEQI.L", "BIO.DE", "ALIG.ST", "PRO.MC", "CAF.MC", "DNR.MI", "HAUTO.OL", "HFG.F", "AFG.OL", "ENGCON-B.ST", "FII.PA", "METSA.HE", "WAF.DE", "TABAK.PR", "GRKP.SW", "DOM.L", "ISN.SW", "ECMPA.AS", "TATT.AT", "JMG.L", "FLUX.BR", "DOM.WA", "FAN.L", "PEP.WA", "ASL.L", "TIP.MI", "OHB.DE", "SPT.L", "WUW.DE", "TRE.MC", "AIXA.DE", "CLAS-B.ST", "YSN.DE", "HTWS.L", "OXIG.L", "FOUR.L", "JEN.DE", "MONY.L", "LDA.MC", "ALPH.L", "HBMN.SW", "CKN.L", "NP3.ST", "ATEA.OL", "PAAL-B.CO", "CRN.L", "MTG-A.ST", "IHP.L", "EDIN.L", "SEM.LS", "REHN.SW", "FORN.SW", "DIGI.RO", "PETS.L", "ANOD-B.ST", "GRNG.ST", "BFIT.AS", "INTEA-B.ST", "WOSG.L", "FSV.L", "ICOS.MI", "DIA.MC", "NEWA-B.ST", "HRI.L", "ASHM.L", "WAVE.PA", "NONG.OL", "HHFA.DE", "BIM.SW", "SKIS-B.ST", "ALTR.LS", "PAGE.L", "SENS.SW", "AGT.L", "4IG.BD", "XIOR.BR", "ELK.OL", "BOY.L", "CHG.L", "LNZ.VI", "ENG.WA", "VOS.DE", "CHEMM.CO", "NRO.PA", "KLR.L", "CURY.L", "IF.MI", "DOU.DE", "COP.DE", "LAMDA.AT", "NXU.DE", "OPG.WA", "BBGI.L", "EPR.OL", "VSVS.L", "NCH2.F", "FSKRS.HE", "A3M.MC", "DNO.OL", "CRBN.AS", "OPTIMA.AT", "BRKN.SW", "BAKK.L", "NEAG.SW", "ONT.L", "JUVE.MI", "TIFS.L", "AERO.SW", "EUZ.DE", "BDB.MI", "ZUGN.SW", "DHG.IR", "TRST.L", "BILI-A.ST", "JFJ.L", "BFG.MI", "YOU.BE", "OVH.PA", "ELG.DE", "BEIA-B.ST", "PSG.MC", "EVT.DE", "SES.MI", "BRWM.L", "SUPR.L", "PAL.VI", "GDS.PA", "TFG.AS", "RPI.L", "STG.CO", "FGP.L", "LHV1T.TL", "INWI.ST", "HEIJM.AS", "AEDAS.MC", "MAU.PA", "NORCO.OL", "GEN.L", "TRY.L", "SCATC.OL", "FAE.MC", "JFN.SW", "AEGN.AT", "BAR.BR", "EDR.MC", "TKTT.PA", "MED.SW", "RATO-A.ST", "SFER.MI", "NA9.BE", "AEVS.SW", "PNE3.DE", "TGN.RO", "FUTR.L", "HYQ.F", "CZG.PR", "POS.VI", "KNOS.L", "LSS.PA", "COR.LS", "MERY.PA", "M8Y.F", "GRE.MC", "TROAX.ST", "DRW8.DE", "ITM.MI", "SVN.IC", "DWL.L", "GUBRA.CO", "CGT.L", "ADV.DE", "BFSA.DE", "SAIN.L", "BIOG-B.ST", "RICA.L", "EGL.LS", "HOME.MC", "ALMA.HE", "TMPL.L", "OBEL.BR", "CTT.LS", "SL.MI", "CIBUS.ST", "CASH.MC", "NAS.OL", "CRED-A.ST", "BASS.PA", "DEZ.DE", "PPET.L", "HIAG.SW", "FPAR-A.ST", "TFIF.L", "VH2.BE", "WKP.L", "GPP.WA", "PUUILO.HE", "ELEC.PA", "MUT.L", "YVIV.MC", "RUSTA.ST", "AOX.DE", "COPN.SW", "ELM.L", "MIPS.ST", "IEM.L", "VCT.L", "VETO.PA", "XVIVO.ST", "GVS.MI", "ACT.DE", "ARJO-B.ST", "SVITZR.CO", "AMAG.VI", "NCAB.ST", "XB1.F", "MRCH.L", "AWE.L", "GNC.L", "OPUS.BD", "SWON.SW", "INF1T.TL", "GBG.L", "DBG.PA", "74SW.PA", "BPCR.L", "LEHN.SW", "VARV.MI", "XPS.L", "TYRES.HE", "KIN.BR", "ADT1.L", "SLR.MC", "SLR.MC", "EAT.WA", "NEU.WA", "MILDEF.ST", "VLTSA.PA", "HFG.L", "CALT.MI", "TIMA.F", "ESCT.L", "9638.HK", "RHK.DE", "SDP.L", "ATT.ST", "AMBEA.ST", "FREY.PA", "CRAYN.OL", "PTSB.IR", "BRIM.IC", "COK.DE", "LTA.PA", "RET.BR", "JM.ST", "YCPS.MC", "BONHR.OL", "HARVIA.HE", "MLP.DE", "IR5B.IR", "DIOS.ST", "KAR.ST", "KARE.AT", "AREIT.PA", "GVR.IR", "EPIC.SW", "MUM.DE", "ATG.L", "OVS.MI", "MEGP.L", "IAD.L", "SPI.L", "MLMTP.PA", "FNAC.PA", "NBPE.L", "GSCT.L", "EL.RO", "ELHA.AT", "SAVE.PA", "ETS.VI", "SAR.AT", "PPA.AT", "COM.MI", "VOLO.ST", "NTG.CO", "FOI-B.ST", "RWI.L", "IBST.L", "MOON.L", "IMPN.SW", "ZIG.L", "AML.L", "EKT.DE", "BAG.L", "AMS.SW", "ARBN.SW", "AKTIA.HE", "ALFA.L", "ZV.MI", "PLAZ-B.ST", "KIT.OL", "USA.L", "GRP.L", "SNR.L", "SMHN.DE", "ENC.MC", "INSTAL.ST", "JDW.L", "RAY-B.ST", "SFQ.F", "EC.PA", "LAMPS.AT", "CORD.L", "PLAN.SW", "KCO.DE", "SPA.BR", "PON1V.HE", "HAGA.IC", "JII.L", "ARN.MI", "CDA.PA", "JST.DE", "RSGN.SW", "PBB.BE", "ACAD.ST", "SOR.OL", "CMB.MI", "TOKMAN.HE", "ATO.PA", "FERGR.AS", "VIL.PA", "MTRO.L", "GCP.L", "ISF.IC", "AUTN.SW", "DNORD.CO", "OLVAS.HE", "KURN.SW", "CHG.DE", "RLIA.MC", "DAR.L", "MTU.PA", "PRSR.L", "EIN.F", "BIOT.ST", "VJBA.CO", "DFDS.CO", "MSLH.L", "DVL.WA", "FIA1S.HE", "MUX.BE", "CLA-B.ST", "BGFD.L", "ASE.WA", "S92.DE", "INH.F", "PEY.L", "EWI.L", "KEMPOWR.HE", "STO3.F", "PCFT.L", "STM.DE", "BKS.VI", "SDG.PA", "JSW.WA", "SNC.LS", "OTV2.L", "VOF.L", "SLP-B.ST", "SHED.L", "WHA.AS", "CMCX.L", "MMGR-B.ST", "TNIE.BE", "PIA.MI", "BYS.SW", "MLCFM.PA", "PVN.MI", "CWC.DE", "TFBANK.ST", "BETCO.ST", "BERG-B.ST", "FAG.ST", "HET.L", "APGN.SW", "NORION.ST", "752.F", "APAX.L", "ONTEX.BR", "ADX.MC", "VBG-B.ST", "AGR.VI", "ELN.MI", "CGEO.L", "NORBT.OL", "UPR.IR", "NWG.WA", "MGAM.L", "THRL.L", "VAC.PA", "BUT.L", "MATAS.CO", "SDIP-B.ST", "REG1V.HE", "MUSTI.HE", "AO.L", "TGHN.DE", "HSL.L", "CEN.PA", "JEDT.L", "NMAN.ST", "KVIKA.IC", "STORY-B.ST", "GLJ.DE", "BEN.PA", "CORE-A.ST", "QUEST.AT", "EXM.BR", "BRGE.L", "ESP.L", "EIFF.PA", "M.RO", "BOUV.OL", "ALLIGO-B.ST", "ELIOR.PA", "EOT.L", "NWL.MI", "INLOT.AT", "BRSC.L", "DSCV.L", "SYNSAM.ST", "TEL.RO", "ADN1.DE", "MARR.MI", "EYDAP.AT", "ARAMI.PA", "DYVOX.ST", "SYNC.L", "HWG.L", "ADMIE.AT", "MEKO.ST", "PKTM.SW", "MPCC.OL", "BSIF.L", "LUVE.MI", "ASC.MI", "SIP.BR", "ACOMO.AS", "BOOZT.ST", "AUB.PA", "PHI.L", "VER.ST", "SWTQ.SW", "KOF.PA", "MLPLC.PA", "ODF.OL", "GROW.L", "FESTI.IC", "HOFI.ST", "SPKSJF.CO", "THEP.PA", "WARN.SW", "VBK.DE", "ZEHN.SW", "VRC.WA", "EXA.PA", "CHRY.L", "TOM2.AS", "UBXN.SW", "DOCS.L", "SUS.ST", "PAT.DE", "EGR1T.TL", "FLOB.BR", "GLO.PA", "KOMN.SW", "ATYM.L", "NORVA.ST", "RECT.BR", "PPH.L", "PPGN.SW", "MUB.DE", "GFT.DE", "MBB.DE", "SATS.OL", "BMY.L", "YZBL.MC", "BUR.PA", "1AT.WA", "OTOEL.AT", "CTY1S.HE", "SCHP.PA", "PCZ.DE", "SIS.DE", "SCANFL.HE", "VETN.SW", "MOZN.SW", "AFK.OL", "TRE.OL", "SVEAF.ST", "BSLN.SW", "GDWN.L", "HTG.L", "FEML.L", "WPL.WA", "TKBP.SW", "CAF.PA", "NAS.L", "LPE.PA", "JEGI.L", "SBO.VI", "LINK.OL", "SBT.PA", "APR.WA", "GTC.WA", "ATTICA.AT", "EG7.IR", "THG.L", "CBAV.MC", "CCR.L", "PHIL.MI", "SECARE.ST", "ABS.WA", "VASTB.BR", "MN.MI", "BLKB.SW", "FREN.SW", "SVOL-A.ST", "POLN.L", "QDT.PA", "BOWL.L", "FILA.MI", "PHARM.AS", "RING.OL", "TTK.DE", "NXI.PA", "ARH.WA", "VIRI.PA", "CRC.RO", "RCS.MI", "EQS.PA", "OAP3.L", "XFAB.PA", "CER.L", "ATS.VI", "AIE.L", "RBW.WA", "CRST.L", "KID.OL", "CBG.L", "CRT.L", "VLA.PA", "PAY.L", "TFF.PA", "LSC.L", "MAB1.L", "SPG.CO", "WHR.L", "WSU.F", "MEKKO.HE", "FSFL.L", "METN.SW", "GSF.OL", "CIR.MI", "PARB.OL", "NRG.PA", "KRI.AT", "ATR.L", "BRNL.AS", "R4.MC", "STEF-B.ST", "YIT.HE", "LINDEX.HE", "VPBN.SW", "IDIP.PA", "REITIR.IC", "NCC.L", "CBF.WA", "THRG.L", "MLG.WA", "AAS.L", "ATT.WA", "PLEJD.ST", "OHLA.MC", "ELLAKTOR.AT", "NBG6.DE", "EVS.BR", "ETG.DE", "ALGIL.PA", "CSN.L", "SBB-B.ST", "GOTL-A.ST", "HTRO.ST"]

# Download function
def download_and_save(tickers, start_date="2019-01-01", end_date="2025-03-27"):
    try:
        print(f"Downloading {len(tickers)} stocks...")
        data = yf.download(
            tickers=tickers,
            start=start_date,
            end=end_date,
            group_by="ticker",
            progress=False,
            threads=True
        )
        
        # Save each stock to a separate CSV
        for ticker in tickers:
            if ticker in data:
                df = data[ticker]
                df.to_csv(f"{OUTPUT_DIR}/{ticker}_historical.csv")
                print(f"Saved: {ticker} ({len(df)} rows)")
            else:
                print(f"⚠️ Missing data for: {ticker}")
        
    except Exception as e:
        print(f"❌ Error: {e}")

# Execute (with a 20-second delay between batches to avoid API throttling)
batch_size = 20
for i in range(0, len(tickers), batch_size):
    download_and_save(tickers[i:i+batch_size])
    time.sleep(20)

print(f"\nDone! Check the '{OUTPUT_DIR}' folder for CSV files.")
